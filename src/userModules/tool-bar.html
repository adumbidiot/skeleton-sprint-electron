<link rel="import"  href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="tool-bar">
    <template>
        <style>
            #container{
                position:absolute;
                right:10px;
                top:10px;
                height:50px;
                width:50px;
                outline: 1px solid black; 
                background-image: url('../images/background.png');
				z-index: 3;
            }
			#note{
                position:absolute;
                width: 50px;
				height: 50px;
				top:0px;
                left:0px;
			}
        </style>
	    <div id="container" on-click="clickblock" on-dragstart="dragstartblock">
			<img src="./images/note.png" id="note" alt="note"/>
		</div>
		<paper-dialog id="noteDialog" modal>
			<div>
				<paper-icon-button icon="close" style="top:0px;position:absolute;left:0px;" on-click="closeNoteDialog"></paper-icon-button>
			</div>
			<div style="padding-top: 10px;">
				<h1>Note Content</h1>
				<paper-input label="Note Content" id="note-content"></paper-input>
				<paper-button raised style="width: 100px;" on-click="okNoteDialog">Ok</paper-button>
			</div>
		</paper-dialog>
    </template>
    <script>
    class ToolBar extends Polymer.Element {
        static get is() { 
            return "tool-bar"; // Just in case i forget
        }
        constructor(){
            super();
        }
		clearNoteDialog(){
			this.$['note-content'].value = '';
		}
        closeNoteDialog() {
            this.$['noteDialog'].close();
        }
		okNoteDialog(){
			let id = "Note: " + this.$['note-content'].value;
            this.closeNoteDialog();
			level.setActive(id);
		}
        clickblock(event){
            let id = event.target.id;
            if(id === 'container') return;
            
            let currentActive = level.getActive();
            
			if(id === currentActive) id = null;
			if(currentActive && currentActive.startsWith('Note:') && id === 'note') id = null;
			if(id !== null && id === "note") this.$['noteDialog'].open();
			event.target.style.outline = "5px dotted powderblue";
            event.target.style.zIndex = "1";
			if(currentActive){
                var currentActiveBlock = this.$[currentActive] || this.$['note'];
                currentActiveBlock.style.outline = '0px';
                currentActiveBlock.style.zIndex = '0';
			}
            
            if(id === 'note'){
                level.setActive('Note:');
            }
		}

		dragstartblock(event){
			event.target.click();
			event.preventDefault(); // In Soviet Russia you dont drag block. BLOCK DRAG YOU
		}    
    }
    customElements.define(ToolBar.is, ToolBar);
				
  </script>
</dom-module>

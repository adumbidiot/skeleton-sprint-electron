<link rel="import"  href="./level-view.html">
<link rel="import"  href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import"  href="../bower_components/paper-toggle-button/paper-toggle-button.html">

<dom-module id="export-level">
    <template>
        <style>
            #cancel{
                position: absolute; 
                bottom: 2px; 
                right: 2px;
            }

            #export{
                position: absolute; 
                left: 40%; 
                width: 20%; 
                top: 80%;
            }
            .container{
                outline: 2px solid black;
                position: absolute;
            }
            p{
                text-align: center;
            }
            #type{
                 width: 90%;
                 left: 5%;
                 top: 5%;
                 height: 50%;
            }
            #format{
                 width: 90%;
                 left: 5%;
                 top: 60%;
            }
        </style>
        
        <button on-click="cancelHandler" id="cancel">Cancel</button>
        <button on-click="exportHandler" id="export">Export</button>

        <div class="container" id="type">
            <p>Export Type</p>
            <paper-radio-group selected="{{format}}" >
                <paper-radio-button name="AS3">
                    <span>Export for Developers</span>
                </paper-radio-button>
                <br>

                <paper-radio-button name="lbl">
                    <span>Export for import into game</span>
                </paper-radio-button>
                <br>                    
                    
                <paper-radio-button name="png">
                    <span>PNG Rendering of Level</span>
                </paper-radio-button>
            </paper-radio-group>
        </div>
        <div class="container" id="format">
            <p>Export Options</p>
            <paper-toggle-button checked="{{text}}">Text Export</paper-toggle-button>
            <paper-toggle-button checked="{{download}}">Download</paper-toggle-button>
        </div>
    </template>

    <script>
    class ExportLevel extends LevelView {
        static get is() { 
            return "export-level"; 
        }

        static get properties(){
            return {
                format: {
                    type: String,
                    observer: '_formatChanged'
                },
                text: {
                    type: Boolean,
                    observer: '_textChanged'
                },
                download: {
                    type: Boolean,
                    observer: '_downloadChanged'
                }
            }
        }
        
        constructor(popMngr){
            super(popMngr);
            this.format = "AS3";
            this.text = true;
            this.download = false;
        }

        //TODO: Remove application-specific code
        exportHandler(){
            if(this.form == 'AS3'){
                var data = level.export();
                if(this.text){
			        document.getElementById('interface').value = data;
                }
                if(this.download){
                    download(data, 'mylvl.txt', 'attachment/text');
                }
			}else if(this.form == 'lbl'){
                var data = level.exportLBL();
                if(this.text){
			        document.getElementById('interface').value = data;
                }
                if(this.download){
                    download(data, 'mylvl.txt', 'attachment/text');
                }
			}else if(this.form == 'png'){
                level.exportPNG(function(data){
                    if(this.text){
			            document.getElementById('interface').value = data;
                    }
                    if(this.download){
                        download(data, 'mylvl.png', 'image/png');
                    }
				});
				exportlvlPNG();
			}
            this.close();
        }
        
        _formatChanged(newFormat, oldFormat){
               this.form = newFormat;
        }

        _textChanged(newFormat, oldFormat){
               this.text = newFormat;
        }
        
         _downloadChanged(newFormat, oldFormat){
               this.download = newFormat;
        }
         
    }

    customElements.define(ExportLevel.is, ExportLevel);
				
  </script>

</dom-module>


